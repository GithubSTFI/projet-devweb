<div class="dashboard-layout" [class.mobile-menu-open]="isMobileMenuOpen()">
    <!-- Overlay Mobile -->
    <div class="mobile-overlay" [class.active]="isMobileMenuOpen()" (click)="closeMobileMenu()">
    </div>

    <!-- Sidebar Glassmorphism Premium -->
    <aside class="sidebar" [class.collapsed]="isSidebarCollapsed() && !isMobile()"
        [class.mobile-open]="isMobileMenuOpen()">
        <!-- Logo Section -->
        <div class="logo-section">
            <div class="logo-box">
                <span class="material-icons">bolt</span>
            </div>
            <span class="logo-text">TaskFlow</span>
        </div>

        <!-- Navigation Links -->
        <nav class="nav-links">
            <a routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
                class="nav-item" (click)="closeMobileMenu()">
                <span class="material-icons">dashboard</span>
                <span class="nav-text">Vue d'ensemble</span>
            </a>
            <a routerLink="/dashboard/tasks" routerLinkActive="active" class="nav-item" (click)="closeMobileMenu()">
                <span class="material-icons">task_alt</span>
                <span class="nav-text">Mes tâches</span>
            </a>
            <a routerLink="/dashboard/files" routerLinkActive="active" class="nav-item" (click)="closeMobileMenu()">
                <span class="material-icons">folder</span>
                <span class="nav-text">Fichiers</span>
            </a>

            <!-- Admin specific links -->
            <div class="nav-divider" *ngIf="user()?.role === 'ADMIN'"></div>
            <span class="nav-label" *ngIf="user()?.role === 'ADMIN'">Administration</span>

            <a *ngIf="user()?.role === 'ADMIN'" routerLink="/dashboard/admin/users" routerLinkActive="active"
                class="nav-item" (click)="closeMobileMenu()">
                <span class="material-icons">group</span>
                <span class="nav-text">Utilisateurs</span>
            </a>
            <a *ngIf="user()?.role === 'ADMIN'" routerLink="/dashboard/admin/tasks" routerLinkActive="active"
                class="nav-item" (click)="closeMobileMenu()">
                <span class="material-icons">assignment</span>
                <span class="nav-text">Tâches Globales</span>
            </a>
            <a *ngIf="user()?.role === 'ADMIN'" routerLink="/dashboard/admin/logs" routerLinkActive="active"
                class="nav-item" (click)="closeMobileMenu()">
                <span class="material-icons">history</span>
                <span class="nav-text">Audit Trail</span>
            </a>
        </nav>

        <!-- User Section at Bottom -->
        <div class="user-sidebar">
            <div class="avatar">
                {{ (user()?.username || 'U')[0].toUpperCase() }}
            </div>
            <div class="user-info">
                <span class="user-name">{{ user()?.username }}</span>
                <span class="user-role">{{ user()?.role || 'User' }}</span>
            </div>
            <span class="material-icons logout-btn" (click)="logout()" title="Déconnexion">
                logout
            </span>
        </div>
    </aside>

    <!-- Header Premium -->
    <header class="header" [class.wide]="isSidebarCollapsed() && !isMobile()">
        <button class="menu-toggle" (click)="toggleSidebar()">
            <span class="material-icons">{{ isSidebarCollapsed() && !isMobile() ? 'menu' : 'menu_open' }}</span>
        </button>

        <div class="search-bar">
            <span class="material-icons">search</span>
            <input type="text" placeholder="Rechercher...">
        </div>

        <div class="header-actions">
            <div class="notifications-wrapper">
                <button class="icon-btn" (click)="toggleNotifications(); $event.stopPropagation()">
                    <span class="material-icons">notifications</span>
                    <span class="badge" *ngIf="unreadCount() > 0">{{ unreadCount() }}</span>
                </button>

                <!-- Notifications Dropdown -->
                <div class="notifications-dropdown" *ngIf="showNotifications()" (click)="$event.stopPropagation()"
                    [@dropdownAnimation]>
                    <div class="dropdown-header">
                        <h3>Notifications</h3>
                        <span class="count">{{ unreadCount() }} non lues</span>
                    </div>
                    <div class="dropdown-body">
                        <div *ngFor="let n of notifications()" class="notification-item" [class.unread]="!n.isRead"
                            (click)="markAsRead(n.id)">
                            <div class="n-dot" *ngIf="!n.isRead"></div>
                            <div class="n-content">
                                <p class="n-message">{{ n.message }}</p>
                                <span class="n-time">{{ n.createdAt | date:'short' }}</span>
                            </div>
                        </div>
                        <div *ngIf="notifications().length === 0" class="empty-notifications">
                            <span class="material-icons">notifications_off</span>
                            <p>Aucune notification</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="main-wrapper" [class.wide]="isSidebarCollapsed() && !isMobile()">
        <div class="content-inner">
            <router-outlet></router-outlet>
        </div>
    </main>
</div>